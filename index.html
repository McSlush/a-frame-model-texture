<html>
  <head>
      <script src="https://rawgit.com/aframevr/aframe/3035117/dist/aframe-master.min.js"></script>
    <script>

      var material = null;
      var objectToTexture = null;
      var textures = [];

      AFRAME.registerComponent("boom-texture", {
        schema: {
          textures: {default: []},
        },

        init: function() {
          var el = this.el;
          textures = this.data.textures;
          objectToTexture = this.el;

          var voxels = [];

          textures.push(new THREE.TextureLoader().load('model/boombox/BoomBox_baseColor.png'));
          textures.push(new THREE.TextureLoader().load('model/boombox/BoomBox_occlusionRoughnessMetallic.png'));

          el.addEventListener('model-loaded', function (e) {
            e.detail.model.traverse(function(node) {
              if (node.isMesh) {
                material = node.material.map ;
              }
            });
          });

          this.el.addEventListener("mousedown", function() {
            var newVoxelEl = null;
            for(var i = 0; i < textures.length; i++) {
              newVoxelEl = document.createElement("a-entity");
              newVoxelEl.setAttribute("mixin", "voxel"+(i+1));
              newVoxelEl.setAttribute('position', { x: i*0.015, y: 0.01, z: 0 });
              this.appendChild(newVoxelEl);
              voxels[i] = newVoxelEl;
            }
          });

            this.el.addEventListener("mouseup", function() {
              if(textures.length != 0){
                  for(var i = 0; i < voxels.length; i++) {
                      if(voxels[i].parentNode != null) {
                      voxels[i].parentNode.removeChild(voxels[i]);
                      }
                  }
              }
            });


/*
            AFRAME.registerComponent("get-texture-type", {
                init: function() {
                    this.el.addEventListener("mouseup", function() {
                        var texture = this.getAttribute("class");
                        objectToTexture.setAttribute("material", "src", "#" + texture);
                        objectToTexture.setAttribute("color", "white");

                    })
                }
            });

          el.addEventListener('click', function (e) {
            var currentImg = material.image;
            if(currentImg.getAttribute("src") == textures[1].image.getAttribute("src")) {
              currentImg.setAttribute("src", textures[0].image.getAttribute("src"));
            } else {
              currentImg.setAttribute("src", textures[1].image.getAttribute("src"));
            }
          });*/
        },
      });

      AFRAME.registerComponent("get-texture-type", {
        init: function() {
          var el = this.el;

          this.el.addEventListener("mouseup", function(){
            var currentImg = material.image;
            console.log(el.components.material.data.src,textures[0].image.getAttribute("src"))
            var selectedTexture = el.components.material.data.src;
            switch (selectedTexture) {
              case textures[0].image.getAttribute("src"):
                currentImg.setAttribute("src", textures[0].image.getAttribute("src"));
                break;
              case textures[1].image.getAttribute("src"):
                currentImg.setAttribute("src", textures[1].image.getAttribute("src"));
                break;
              default:
                break;

            }
          });
        }
      });


    </script>
  </head>
  <body>
    <a-scene>
    <a-assets>
      <a-mixin id="voxel1" get-texture-type material="src:model/boombox/BoomBox_baseColor.png;" geometry="primitive: box; height: 0.01; width: 0.01; depth: 0.01;"></a-mixin>
      <a-mixin id="voxel2" get-texture-type material="src:model/boombox/BoomBox_occlusionRoughnessMetallic.png;" geometry="primitive: box; height: 0.01; width: 0.01; depth: 0.01;"></a-mixin>
      <a-asset-item id="boombox1" src="model/boombox/BoomBox.gltf"></a-asset-item>
    </a-assets>
      <a-camera>
        <a-cursor></a-cursor>
      </a-camera>
    <a-entity id="boom1" boom-texture gltf-model="#boombox1"  scale="50 50 50" position="0 2 -4"></a-entity>

  </a-scene>
  </body>
</html>
